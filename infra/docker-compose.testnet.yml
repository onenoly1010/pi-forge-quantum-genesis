version: '3.8'
services:
  guardian-coordinator:
    build:
      context: ./guardian-coordinator
      dockerfile: docker/Dockerfile.guardian
    environment:
      - APP_ENVIRONMENT=testnet
      - GUARDIAN_KILL_SWITCH=${GUARDIAN_KILL_SWITCH:-off}
      - NFT_MINT_VALUE=0
    ports:
      - "8001:8000"
    depends_on:
      - db
  fastapi-server:
    build: .
    dockerfile: docker/Dockerfile.fastapi
    ports: ["8000:8000"]
    environment:
      - APP_ENVIRONMENT=testnet
  flask-dashboard:
    build: .
    dockerfile: docker/Dockerfile.flask
    ports: ["5000:5000"]
  gradio-interface:
    build: .
    dockerfile: docker/Dockerfile.gradio
    ports: ["7860:7860"]
  db:
    image: postgres:15
    environment:
      POSTGRES_PASSWORD: guardian_local
      POSTGRES_DB: guardian_coordinator
    ports: ["5433:5432"]
    volumes: [guardian-data:/var/lib/postgresql/data]
volumes:
  guardian-data:
